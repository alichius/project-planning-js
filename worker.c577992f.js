parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"K170":[function(require,module,exports) {
"use strict";var t;function e(t){return"string"==typeof t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isSchedulingFailure=e,exports.JobSplitting=void 0,exports.JobSplitting=t,function(t){t.NONE="none",t.PREEMPTION="preemption",t.MULTIPLE_MACHINES="multi"}(t||(exports.JobSplitting=t={}));
},{}],"UfyB":[function(require,module,exports) {
"use strict";function r(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function t(r,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function a(r,a,n){return a&&t(r.prototype,a),n&&t(r,n),r}function n(r){return Math.trunc((r-1)/2)}function e(r){return 2*r+1}function i(r){return 2*r+2}function o(r,t,a){var n=r[t];r[t]=r[a],r[a]=n}function u(r,t,a){for(var n=a;;){var u=n,h=e(n);h<r.length&&t(r[h],r[u])<0&&(u=h);var s=i(n);if(s<r.length&&t(r[s],r[u])<0&&(u=s),u===n)break;o(r,n,u),n=u}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var h=function(){function t(a,n){r(this,t),this.comparatorFn_=n,this.array_=Array.from(a);for(var e=Math.trunc(this.array_.length/2)-1;e>=0;--e)u(this.array_,this.comparatorFn_,e)}return a(t,[{key:"add",value:function(r){this.array_.push(r);for(var t=this.array_.length-1;;){var a=n(t);if(t<=0||this.comparatorFn_(this.array_[a],this.array_[t])<0)break;o(this.array_,a,t),t=a}}},{key:"extractMin",value:function(){if(0!==this.array_.length){if(1===this.array_.length)return this.array_.pop();var r=this.array_[0];return this.array_[0]=this.array_.pop(),u(this.array_,this.comparatorFn_,0),r}}},{key:"isEmpty",value:function(){return 0===this.array_.length}}]),t}();exports.default=h;
},{}],"B/R2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.computeSchedule=u;var e=require("./api-types"),t=n(require("./minheap"));function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var s=Object.freeze({deliveryTime:0,splitting:e.JobSplitting.PREEMPTION,dependencies:[],releaseTime:0,preAssignment:-1});function u(e){var t=function(e){return e>=0&&Number.isInteger(e)},n=function(e){return void 0===e||t(e)},i=e.machineSpeeds.length,r=e.jobs.length;if(0===i)return"At least one machine is required to compute a schedule.";if(0!==e.machineSpeeds.filter(function(e){return e<=0||!Number.isInteger(e)}).length||e.jobs.filter(function(e){return!(t(e.size)&&function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.filter(function(e){return!n(e)}).length}(e.deliveryTime,e.releaseTime)&&(a=i,s=e.preAssignment,void 0===s||t(s)&&s<a)&&(void 0===e.dependencies||function(e,n){return 0===n.filter(function(n){return!(n>=0&&t(n)&&n<e)}).length}(r,e.dependencies)));var a,s}).length>0||!n(e.minFragmentSize))return"All job processing times and machine speeds need to be non-negative integers. All job dependency and pre-assignment indices need to be within bounds.";var a=e.jobs.map(function(e){return Object.assign({},s,e)}),u=void 0===e.minFragmentSize?0:e.minFragmentSize;return new l(i,e.machineSpeeds,a,u).schedule}var l=function(){function n(e,t,r,a){i(this,n),this.numMachines_=e,this.machineSpeeds_=t,this.jobs_=r,this.minFragmentSize_=a,this.gapsLists_=this.machineSpeeds_.map(function(e){return{head:{startTime:Number.MIN_SAFE_INTEGER,endTime:0},tail:{head:{startTime:0,endTime:Number.MAX_SAFE_INTEGER},tail:null}}}),this.schedule=this.computeSchedule()}return a(n,[{key:"adjustGaps",value:function(e,t,n){var i=e.currentFragmentStart,r=e.gapsList.head;n&&(i===r.startTime&&t===r.endTime?e.previousGapsList.tail=e.gapsList.tail:i===r.startTime?r.startTime=t:t===r.endTime?(r.endTime=i,e.previousGapsList=e.gapsList):(e.previousGapsList.tail={head:{startTime:r.startTime,endTime:i},tail:e.gapsList},r.startTime=t)),t===r.endTime?e.gapsList=e.gapsList.tail:n||(e.gapsList={head:{startTime:t,endTime:r.endTime},tail:e.gapsList.tail}),e.currentFragmentStart=null}},{key:"createJobFragment",value:function(e,t,n){if(n){var i=e.currentFragmentStart;if(t-i>0){var r={machine:e.index,start:i,end:t,isWaiting:!1};n.push(r)}}this.adjustGaps(e,t,void 0!==n)}},{key:"scheduleJob",value:function(e,t,i,r,a){for(var s=this,u=i?Math.min(t,this.minFragmentSize_):t,l=0,c=r,o=t,d=e.map(function(e,t){var n=s.gapsLists_[e];return{index:e,availableIdx:t,speed:s.machineSpeeds_[e],currentFragmentStart:null,previousGapsList:n,gapsList:n.tail}}),m=function(){var t=Number.MAX_SAFE_INTEGER,i=d[0];e.forEach(function(e,a){var s=Math.ceil(u/d[a].speed),l=n.nextTimeStamp(s,r,d[a]);l<t&&(t=l,i=d[a])});var m=!1,h=Math.ceil(c+o/l);if(h<t&&(t=h,m=!0),o-=(t-c)*l,!m)if(null===i.currentFragmentStart){var p=i.gapsList.head;i.currentFragmentStart=Math.max(r,p.startTime),o-=(t-i.currentFragmentStart)*i.speed,l+=i.speed}else s.createJobFragment(i,t,a),l-=i.speed;c=t};o>0;)m();return e.forEach(function(e,t){null!==d[t].currentFragmentStart&&s.createJobFragment(d[t],c,a)}),c}},{key:"allMachines",value:function(){return{length:this.machineSpeeds_.length,forEach:function(e){for(var t=0;t<this.length;++t)e(t,t)},map:function(e){var t=[];t.length=this.length;for(var n=0;n<this.length;++n)t[n]=e(n,n);return t}}}},{key:"computeSchedule",value:function(){for(var i=[],r=this.jobs_.map(function(e,t){return{idx:t,numDependencies:e.dependencies.length,dependents:[]}}),a=0;a<this.jobs_.length;++a){var s=this.jobs_[a],u=r[a],l=!0,c=!1,o=void 0;try{for(var d,m=s.dependencies[Symbol.iterator]();!(l=(d=m.next()).done);l=!0){r[d.value].dependents.push(u)}}catch(z){c=!0,o=z}finally{try{l||null==m.return||m.return()}finally{if(c)throw o}}0===s.dependencies.length&&i.push(u)}for(var h=this.allMachines(),p=this.jobs_.map(function(e){return[]}),f=this.jobs_.map(function(e){return-1}),g=0,v=new t.default(i,function(e,t){return e.idx-t.idx});!v.isEmpty();){var b=v.extractMin(),T=this.jobs_[b.idx],S=T.splitting!==e.JobSplitting.NONE,y=T.dependencies.reduce(function(e,t){var n=f[t];return Math.max(e,n)},T.releaseTime),_=h,L=void 0;if(T.splitting===e.JobSplitting.MULTIPLE_MACHINES)L=T.preAssignment>=0?T.preAssignment:0;else if(T.preAssignment>=0)_=n.singleMachine(T.preAssignment),L=T.preAssignment;else for(var E=Number.MAX_SAFE_INTEGER,M=0;M<this.numMachines_;++M){var F=n.singleMachine(M),x=this.scheduleJob(F,T.size,S,y);x<E&&(_=F,L=M,E=x)}var j=this.scheduleJob(_,T.size,S,y,p[b.idx]);f[b.idx]=n.scheduleDeliveryTime(L,j,T.deliveryTime,p[b.idx]),++g;var A=!0,N=!1,G=void 0;try{for(var I,k=b.dependents[Symbol.iterator]();!(A=(I=k.next()).done);A=!0){var w=I.value;--w.numDependencies,0===w.numDependencies&&v.add(w)}}catch(z){N=!0,G=z}finally{try{A||null==k.return||k.return()}finally{if(N)throw G}}}return g!==this.jobs_.length?"Detected a cycle in the dependency graph.":p}}],[{key:"nextTimeStamp",value:function(e,t,n){var i=n.gapsList.head;if(null!==n.currentFragmentStart)return i.endTime;for(;;){var r=Math.max(t,i.startTime)+e;if(r<=i.endTime)return r;n.previousGapsList=n.gapsList,n.gapsList=n.gapsList.tail,i=n.gapsList.head}}},{key:"scheduleDeliveryTime",value:function(e,t,n,i){var r=t;if(n>0){var a={machine:e,start:t,end:r+=n,isWaiting:!0};i.push(a)}return r}},{key:"singleMachine",value:function(e){return{length:1,forEach:function(t){t(e,0)},map:function(t){return[t(e,0)]}}}}]),n}();
},{"./api-types":"K170","./minheap":"UfyB"}],"kUhx":[function(require,module,exports) {
"use strict";function e(e){return"function"==typeof DedicatedWorkerGlobalScope&&e instanceof DedicatedWorkerGlobalScope}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isDedicatedWorkerGlobalScope=e,exports.workerFactory=void 0;var o={};exports.workerFactory=o;
},{}],"EQ8s":[function(require,module,exports) {
"use strict";var e=require("./scheduling"),r=require("./worker-interface");function t(e){return a(e)||o(e)||n()}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function a(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}if((0,r.isDedicatedWorkerGlobalScope)(self)){var i=function(r){var n=r.data,o=e.computeSchedule.apply(void 0,t(n));c.postMessage(o),c.close()},c=self;c.onmessage=i}
},{"./scheduling":"B/R2","./worker-interface":"kUhx"}]},{},["EQ8s"], null)
//# sourceMappingURL=/project-planning-js/worker.c577992f.js.map